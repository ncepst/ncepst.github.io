# オペアンプ基礎  

## 1. はじめに

オペアンプ（Operational Amplifier）はアナログ回路の基礎デバイスであり、  
その本質は**トランジスタレベルの増幅段構成とフィードバック理論** にある。

本記事では、以下を体系的にまとめる。

- トランジスタレベルでの動作理解  
- オペアンプ回路の設計理論  
- 周波数特性と安定性（位相余裕）  
- 位相補償（ミラー補償）  
- CMOS オペアンプの簡易設計例（W/L・バイアス・補償）

---

## 2. オペアンプの内部構成（トランジスタレベル）

一般的な CMOS オペアンプは、以下の 3 段構成で理解できる。

1. 差動増幅段（入力段）  
2. 電圧増幅段（ゲイン段）  
3. 出力段（バッファ）

### 2.1 差動増幅段（入力段）

差動入力 ${v_d = v_+ - v_-}$ に対して、差動電流は

$$
\Delta I = \frac{1}{2} g_m v_d
$$

となる。

差動対の役割は

- 高入力インピーダンス  
- 差動信号の増幅  
- CMRR の確保  

である。

### 2.2 電圧増幅段（ゲイン段）

MOSFET の単段増幅器の利得は

$$
A_v = g_m r_o
$$

で近似される。

多段構成では総合開ループ利得は

$$
A_{\mathrm{OL}} \approx A_1 A_2
$$

となる。

### 2.3 出力段（バッファ）

出力段は負荷を駆動するための段であり、低出力インピーダンスと電流供給能力を提供する。

---

## 3. 理想オペアンプと実オペアンプ

### 3.1 理想オペアンプの仮定

- 入力インピーダンス：無限大  
- 出力インピーダンス：0  
- 開ループ利得：無限大  
- 帯域：無限大  

このとき、負帰還をかけると

${v_+ \approx v_-}$

が成り立つ（仮想短絡）。

### 3.2 実オペアンプの特徴

- 開ループ利得は有限（60〜120 dB）  
- 周波数特性は 1 次または多次のロールオフ  
- 入力バイアス電流・オフセットが存在  

特に **開ループ利得と周波数特性** が安定性に直結する。

---

## 4. フィードバックと閉ループ利得

閉ループ利得は

$$
A_{\mathrm{CL}} = \frac{A_{\mathrm{OL}}}{1 + A_{\mathrm{OL}} \beta}
$$

ループゲインは

$$
T = A_{\mathrm{OL}} \beta
$$

ループゲインが十分大きいとき

$$
A_{\mathrm{CL}} \approx \frac{1}{\beta}
$$

となる。

---

## 5. 周波数特性と極・零点

### 5.1 開ループ利得モデル

$$
A_{\mathrm{OL}}(j\omega) = \frac{A_0}{1 + j\omega / \omega_p}
$$

- ${A_0}$：DC 利得  
- ${\omega_p}$：ドミナントポール  

### 5.2 ゲイン帯域幅積（GBW）

$$
\mathrm{GBW} = A_0 \cdot f_p
$$

閉ループ利得を上げると帯域が狭くなる式。

---

## 6. 安定性と位相余裕

ループゲイン

$$
T(j\omega) = A_{\mathrm{OL}}(j\omega)\beta
$$

位相余裕 PM は

$$
\mathrm{PM} = 180^\circ + \angle T(j\omega_{0dB})
$$

一般的な目安：

- PM > 60°：十分安定  
- PM ≈ 45°：実用的  
- PM < 30°：発振の危険  

---

## 7. 位相補償（ミラー補償）

ミラー補償では、補償容量 ${C_c}$ により低周波側にドミナントポールを生成する。

### 7.1 ドミナントポール

$$
\omega_p \approx \frac{1}{g_{m2} r_{o2} C_c}
$$

### 7.2 ゼロ（ミラー効果）

$$
\omega_z \approx \frac{g_{m2}}{C_c}
$$

右半平面ゼロ（RHPZ）となる場合は直列抵抗で補償する。

---

## 8. LTspice による解析

### 8.1 開ループ Bode プロット

- フィードバックを切る  
- 入力に AC 1 V  
- 出力の振幅と位相を観測  

### 8.2 ステップ応答

- 閉ループ構成を組む  
- ステップ入力を与える  
- オーバーシュート・リンギング・セトリング時間を評価  

---

## 9. CMOS オペアンプの簡易設計例

### 9.1 仕様例

- 電源：1.8 V  
- GBW：20 MHz  
- 位相余裕：60°  
- 負荷：10 pF  

### 9.2 入力段の gm 設計

$$
\mathrm{GBW} \approx \frac{g_{m1}}{2\pi C_c}
$$

例： ${\mathrm{GBW}=20\ \mathrm{MHz}}$, ${C_c=2\ \mathrm{pF}}$

$$
g_{m1} \approx 0.25\ \mathrm{mS}
$$

### 9.3 ゲイン段の利得設計

ドミナントポールを ${10\ \mathrm{kHz}}$ に置くと

$$
A_{\mathrm{OL}} \approx \frac{20\ \mathrm{MHz}}{10\ \mathrm{kHz}} = 2000 \approx 66\ \mathrm{dB}
$$

### 9.4 補償容量の初期値

$$
C_c \approx \frac{g_{m1}}{2\pi \mathrm{GBW}}
$$

### 9.5 出力段の設計

スルーレートは

$$
\mathrm{SR} \approx \frac{I_{\mathrm{bias}}}{C_L}
$$

負荷容量とバイアス電流のトレードオフを考慮する。

---
