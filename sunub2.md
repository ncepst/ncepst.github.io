# MOSFETスイッチング波形解析・スナバ設計・EMI理論  
（実測波形からの逆算とフライバックRCD設計）

---

## 0. 本記事の目的

本記事では以下を **理論ベースかつ実務で再現可能**な形で整理する。

1. MOSFETスイッチング波形（Vdsリンギング）から  
   **寄生インダクタンス L と寄生容量 C を逆算する方法**
2. フライバック電源における  
   **RCDスナバ（クランプ）の設計理論と初期値算出**
3. スナバ回路が  
   **EMI（伝導・放射）にどう効くかの周波数領域での理論解析**

---

## 1. MOSFETスイッチング波形から L と C を逆算する

### 1.1 観測している「共振系」を定義する

MOSFETのドレイン電圧 \(V_{ds}\) に現れるリンギングは、主に以下の等価回路で説明できる。

- 寄生インダクタンス  
  - 配線ループ  
  - MOSFETパッケージ  
  - スイッチング電流ループ
- 寄生容量  
  - MOSFETの \(C_{oss}\)  
  - 周辺配線・基板寄生容量

これらが **LC共振回路**を形成する。

---

### 1.2 リンギング周波数から LC の積を求める

リンギング周波数 \(f_r\) をオシロスコープで測定すると、

\[
\omega_r = 2\pi f_r
\]

\[
\omega_r \approx \frac{1}{\sqrt{LC}}
\]

したがって、

\[
LC \approx \frac{1}{\omega_r^2}
\]

ここで得られるのは **LとCの積のみ**であり、分離には追加情報が必要。

---

### 1.3 既知容量を追加して L と C を分離する（最重要）

#### 方法概要
リンギングノードに **既知の微小容量 \(\Delta C\)** を追加し、
周波数変化から元の C を逆算する。

#### 周波数変化
- 追加前：\(f_1\)
- 追加後：\(f_2\)

モデル：

\[
f = \frac{1}{2\pi\sqrt{L(C+\Delta C)}}
\]

よって、

\[
\left(\frac{f_1}{f_2}\right)^2
= \frac{C+\Delta C}{C}
= 1 + \frac{\Delta C}{C}
\]

#### 元の寄生容量 C

\[
C = \frac{\Delta C}{\left(\frac{f_1}{f_2}\right)^2 - 1}
\]

#### 寄生インダクタンス L

\[
L = \frac{1}{(2\pi f_1)^2 C}
\]

#### 実務上の注意
- \(\Delta C\) は **C0G/NP0** 推奨
- 元のCと同程度の値が精度良好
- 配線が長いと \(\Delta C\) 自体がLを増やすため、**最短実装**

---

### 1.4 減衰包絡線からの補助的推定（参考）

リンギングの包絡線が指数減衰している場合：

\[
v(t) \propto e^{-\alpha t}\cos(\omega_d t)
\]

隣接ピーク振幅 \(A_n, A_{n+1}\) より：

\[
\delta = \ln\left(\frac{A_n}{A_{n+1}}\right)
\]

周期 \(T = 1/f_r\) とすると：

\[
\alpha \approx \frac{\delta}{T}
\]

直列RLC近似では：

\[
\alpha \approx \frac{R}{2L}
\]

※ 実回路では損失要素が多いため **補助的な目安**とする。

---

## 2. フライバック電源の RCD スナバ設計

### 2.1 RCDが処理しているエネルギー

フライバックでは、MOSFETオフ時に  
**一次側漏れインダクタンス \(L_{lk}\)** に蓄積されたエネルギーが問題になる。

\[
E_{lk} = \frac{1}{2} L_{lk} I_{pk}^2
\]

このエネルギーを **Cで受け、Rで熱として消費**するのがRCDスナバ。

---

### 2.2 MOSFET耐圧とクランプ電圧

MOSFETオフ時の基本電圧：

\[
V_{ds,base} \approx V_{in,max} + V_{ref}
\]

\[
V_{ref} = \frac{N_p}{N_s}(V_o + V_d)
\]

クランプ後の最大電圧：

\[
V_{ds,max} \approx V_{in,max} + V_{ref} + V_{clamp}
\]

設計指針：
- \(V_{ds,max}\) は耐圧の **70〜85%以下**を目標（一般論）

---

### 2.3 クランプコンデンサ C の設計

1周期でのクランプ電圧リップルを \(\Delta V\) とすると：

\[
E_{lk}
\approx \frac{1}{2} C
\left(
(V_{clamp}+\Delta V)^2 - V_{clamp}^2
\right)
\]

\(\Delta V \ll V_{clamp}\) の近似より：

\[
E_{lk} \approx C V_{clamp} \Delta V
\]

\[
C \approx
\frac{\frac{1}{2} L_{lk} I_{pk}^2}
{V_{clamp} \Delta V}
\]

実務では：

\[
\Delta V \approx (0.05 \sim 0.2)\,V_{clamp}
\]

とすることが多い。

---

### 2.4 クランプ抵抗 R の設計

平均的に抵抗が消費する電力：

\[
P_R \approx E_{lk} f_{sw}
\]

一方、抵抗の消費電力は：

\[
P_R \approx \frac{V_{clamp}^2}{R}
\]

よって、

\[
R \approx \frac{V_{clamp}^2}{E_{lk} f_{sw}}
\]

※ 実波形では近似だが、**初期値として有効**

---

### 2.5 波形ベースの調整指針

- スパイクが高い  
  → \(C\) を増やす
- クランプ電圧が高止まり  
  → \(R\) を下げる
- 損失・発熱が大きい  
  → \(V_{clamp}\) 見直し or \(L_{lk}\) 低減（巻線・レイアウト）

---

## 3. スナバと EMI の理論的関係

### 3.1 EMIを決める主要因

高周波ノイズは主に以下で決まる：

- 電圧立ち上がり速度 \(dv/dt\)
- 電流立ち上がり速度 \(di/dt\)
- 共振回路のQ（鋭さ）
- ループ面積（磁界放射）
- 寄生容量によるコモンモード電流

---

### 3.2 立ち上がり時間と周波数成分

立ち上がり時間 \(t_r\) を持つ波形のスペクトルは、

\[
f \gtrsim \frac{0.35}{t_r}
\]

付近から急激に減衰する。

→ **スナバで \(t_r\) を長くすると高周波成分が減る**

---

### 3.3 リンギングとスペクトルピーク

LC共振はスペクトル上で：

- 共振周波数 \(f_r\) に **鋭いピーク** を作る

RCスナバのRは：

- 共振Qを低下させる
- ピークを潰す（狭帯域EMI低減）

---

### 3.4 伝導EMIと放射EMIへの効き方

- **伝導EMI**  
  - 高周波電流成分が支配  
  - スナバで改善しやすい
- **放射EMI**  
  - ループ面積と電流が支配  
  - スナバ＋レイアウト改善が必須

---

## 4. 実務フローまとめ

1. Vdsリンギング周波数 \(f_r\) を測定  
2. 既知 \(\Delta C\) を追加し \(L, C\) を逆算  
3. RCスナバ初期値：
   \[
   R \approx 2\sqrt{\frac{L}{C}}
   \]
4. フライバックでは別途 RCD を設計  
5. 波形・EMI測定で追い込み

---

## 5. 結論

スナバ設計は：

> 寄生LCの **共振周波数・Q・エネルギー** を  
> 意図的に制御するアナログ設計問題

であり、  
**測定 → 逆算 → 設計 → 再測定** のループが本質である。
